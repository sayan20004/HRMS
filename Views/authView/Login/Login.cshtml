@{
    ViewData["Title"] = "Login Page";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script src="https://www.google.com/recaptcha/api.js?render=@ViewData["RecaptchaSiteKey"]"></script>

<div class="login-container" style="max-width: 450px; margin: 80px auto; padding: 40px; background: #fff; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
    <h2 class="text-center">Login to HRMS</h2>
    
    @if (ViewData["Error"] != null) { <div class="alert alert-danger">@ViewData["Error"]</div> }
    @if (TempData["Success"] != null) { <div class="alert alert-success">@TempData["Success"]</div> }

    <form method="post" asp-action="LoginPost" asp-controller="Register" id="loginForm">
        <div class="form-group mb-3">
            <label>Email Address</label>
            <input type="email" class="form-control" name="email" required>
        </div>

        <div class="form-group mb-3">
            <label>Password</label>
            <input type="password" class="form-control" name="password" required>
        </div>

        <input type="hidden" name="g-recaptcha-response" id="g-recaptcha-response" />

        <button type="submit" class="btn btn-primary w-100">Login</button>
    </form>
    
    <div class="text-center mt-3">
        <a href="@Url.Action("Index", "Register")">Register here</a>
    </div>
</div>

<script>
    document.getElementById('loginForm').addEventListener('submit', function(e) {
        // 1. Stop the form from submitting immediately
        e.preventDefault();
        
        // 2. Request a fresh token from Google
        grecaptcha.ready(function() {
            grecaptcha.execute('@ViewData["RecaptchaSiteKey"]', {action: 'login'}).then(function(token) {
                // 3. Put the token in the hidden input
                document.getElementById('g-recaptcha-response').value = token;
                
                // 4. Submit the form programmatically
                document.getElementById('loginForm').submit();
            });
        });
    });
</script>